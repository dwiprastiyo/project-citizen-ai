<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Project Citizen ‚Äì Cek Kredibilitas Berita</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 30px;
      background: #f9f9f9;
    }
    h1, h2 {
      color: #333;
    }
    ul {
      padding-left: 20px;
    }
    li {
      cursor: pointer;
      margin-bottom: 8px;
    }
    textarea {
      width: 100%;
      max-width: 900px;
      padding: 10px;
      margin-bottom: 10px;
    }
    button {
      padding: 10px 18px;
      font-size: 16px;
      cursor: pointer;
    }
    pre {
      background: #111;
      color: #0f0;
      padding: 15px;
      white-space: pre-wrap;
      max-width: 900px;
      overflow-x: auto;
    }
    .news-source {
      font-size: 12px;
      color: #666;
    }
  </style>
</head>

<body>

<h1>Project Citizen</h1>
<h2>Analisis Kredibilitas & Perbandingan Berita Indonesia</h2>

<hr />

<h2>üì∞ Daftar Berita Nasional</h2>
<p>Klik salah satu berita untuk dimasukkan sebagai Berita A.</p>

<ul id="newsList">
  <li>Memuat berita...</li>
</ul>

<hr />

<h2>üìù Input Berita</h2>

<label><strong>Berita A (Utama)</strong></label><br />
<textarea id="newsA" rows="4" placeholder="Berita utama akan muncul di sini"></textarea>

<label><strong>Berita B (Pembanding / Pro‚ÄìKontra)</strong></label><br />
<textarea id="newsB" rows="4" placeholder="Masukkan berita pembanding (opsional)"></textarea>

<button onclick="analyze()">üîç Analisis Berita</button>

<hr />

<h2>üìä Hasil Analisis</h2>
<pre id="result">Belum ada analisis.</pre>

<script>
  // =========================
  // LOAD BERITA DARI NETLIFY
  // =========================
  async function loadNews() {
    try {
      const res = await fetch("/.netlify/functions/news");
      const data = await res.json();

      const list = document.getElementById("newsList");
      list.innerHTML = "";

      data.forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `
          <strong>${item.title}</strong><br />
          <span class="news-source">${item.source} | ${item.published}</span>
        `;
        li.onclick = () => {
          document.getElementById("newsA").value = item.title;
        };
        list.appendChild(li);
      });

    } catch (err) {
      document.getElementById("newsList").innerHTML =
        "<li>Gagal memuat berita.</li>";
    }
  }

  // =========================
  // ANALISIS BERITA (AI)
  // =========================
  async function analyze() {
  const newsA = document.getElementById("newsA").value.trim();
  const newsB = document.getElementById("newsB").value.trim();
  const resultBox = document.getElementById("result");

  if (!newsA) {
    resultBox.textContent = "‚ö†Ô∏è Berita A wajib diisi.";
    return;
  }

  resultBox.textContent = "‚è≥ Menganalisis berita...";

  try {
    const res = await fetch("/.netlify/functions/analyze", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      
      /* ‚¨áÔ∏è‚¨áÔ∏è Bagian yang kamu tanyakan ‚Äî TARUH DI SINI ‚¨áÔ∏è‚¨áÔ∏è */
      body: JSON.stringify({ newsA, newsB })
      /* ‚¨ÜÔ∏è‚¨ÜÔ∏è WAJIB ADA DI SINI ‚¨ÜÔ∏è‚¨ÜÔ∏è */
    });

    const data = await res.json();

    if (data.error) {
      resultBox.textContent = "‚ùå " + data.error;
      return;
    }

    resultBox.textContent = `
Ringkasan dan Analisis:
${data.analysis_text}

-------------------------
Persentase Risiko: ${data.risk_percentage}%
Level Risiko: ${data.risk_level}
`;
  } catch (err) {
    resultBox.textContent = "‚ùå Gagal menghubungi server.";
  }
}

  // load saat halaman dibuka
  loadNews();
</script>

</body>
</html>
