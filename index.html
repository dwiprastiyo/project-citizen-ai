<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<title>Project Citizen – Cek Kredibilitas Berita</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f9;
    margin: 0;
    padding: 0;
}

header {
    background: #1a73e8;
    color: white;
    padding: 15px;
    text-align: center;
    font-size: 20px;
}

.container {
    padding: 20px;
    max-width: 900px;
    margin: auto;
}

/* BERITA LIST */
.news-list {
    display: grid;
    grid-template-columns: 1fr;
    gap: 15px;
    margin-bottom: 30px;
}

.news-item {
    background: white;
    padding: 15px;
    border-radius: 10px;
    display: flex;
    gap: 15px;
    box-shadow: 0 3px 7px rgba(0,0,0,0.1);
}

.news-item img {
    width: 120px;
    height: 80px;
    object-fit: cover;
    border-radius: 6px;
}

/* TEXT AREA */
textarea {
    width: 100%;
    height: 120px;
    padding: 12px;
    border-radius: 8px;
    border: 1px solid #ccc;
    resize: vertical;
}

/* BUTTON */
button {
    margin-top: 15px;
    padding: 12px 20px;
    background: #1a73e8;
    color: white;
    border: none;
    border-radius: 8px;
    width: 100%;
    cursor: pointer;
    font-size: 16px;
}
button:hover {
    background: #155fcc;
}

/* RESULT BOX */
.result-box {
    background: white;
    padding: 20px;
    border-radius: 10px;
    margin-top: 25px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.15);
}

/* ANALYSIS TEXT AUTO-FIT */
.result-box pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    overflow-wrap: break-word;
    max-height: 350px;
    overflow-y: auto;
    background: #f9f9f9;
    padding: 15px;
    border-radius: 8px;
}

/* SCROLLBAR */
.result-box pre::-webkit-scrollbar {
    width: 8px;
}
.result-box pre::-webkit-scrollbar-thumb {
    background: #1a73e8;
    border-radius: 4px;
}
.result-box pre::-webkit-scrollbar-track {
    background: #e0e0e0;
}

/* RISK BAR */
.risk-bar-container {
    width: 100%;
    background: #ddd;
    height: 12px;
    border-radius: 10px;
}
.risk-bar {
    height: 100%;
    background: #e53935;
    border-radius: 10px;
}

/* LOADING OVERLAY */
.loading-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(255,255,255,0.8);
    backdrop-filter: blur(3px);
    display: none;
    justify-content: center;
    align-items: center;
    z-index: 999;
}

/* MASKOT AI */
.mascot {
    width: 90px;
    animation: spin 1.2s linear infinite;
}

@keyframes spin {
    0% { transform: rotate(0); }
    100% { transform: rotate(360deg); }
}
</style>
</head>

<body>

<header><b>PROJECT CITIZEN – CEK KREDIBILITAS BERITA</b></header>

<div class="loading-overlay" id="loading">
    <img src="https://cdn-icons-png.flaticon.com/512/4712/4712109.png" class="mascot">
</div>

<div class="container">

<h3>Pilih Kategori Berita Indonesia</h3>

<select id="category" onchange="loadNews()">
    <option value="nasional">Nasional</option>
    <option value="politik">Politik</option>
    <option value="ekonomi">Ekonomi</option>
    <option value="teknologi">Teknologi</option>
</select>

<div id="news" class="news-list"></div>

<h3>Masukkan Berita A</h3>
<textarea id="newsA"></textarea>

<h3>Masukkan Berita B (opsional)</h3>
<textarea id="newsB"></textarea>

<button onclick="analyze()">Analisis Berita</button>

<div id="result"></div>

</div>

<script>
const API_URL = "https://project-citizen-ai.netlify.app/.netlify/functions";

/* =======================
   LOAD BERITA INDONESIA
=========================*/
async function loadNews() {
    const category = document.getElementById("category").value;
    const box = document.getElementById("news");

    box.innerHTML = "<p>Memuat berita...</p>";

    try {
        const res = await fetch(`${API_URL}/news?category=${category}`);
        const data = await res.json();

        box.innerHTML = "";

        data.forEach(item => {
            box.innerHTML += `
                <div class="news-item">
                    <img src="${item.image}">
                    <div>
                        <b>${item.title}</b>
                        <p>${item.description}</p>
                    </div>
                </div>
            `;
        });

    } catch (err) {
        box.innerHTML = "<p>Gagal memuat berita.</p>";
    }
}

loadNews();

/* =======================
   ANALISIS AI
=========================*/
async function analyze() {
    const A = document.getElementById("newsA").value;
    const B = document.getElementById("newsB").value;

    if (!A.trim()) {
        alert("Berita A wajib diisi.");
        return;
    }

    document.getElementById("loading").style.display = "flex";

    try {
        const res = await fetch(`${API_URL}/analyze`, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ newsA: A, newsB: B })
        });

        const data = await res.json();

        const resultBox = document.getElementById("result");

        resultBox.innerHTML = `
            <div class="result-box">
                <h3>Hasil Analisis</h3>
                <pre>${data.analysis_text}</pre>

                <h4>Tingkat Risiko</h4>
                <div class="risk-bar-container">
                    <div class="risk-bar" style="width:${data.risk_percentage}%"></div>
                </div>
                <p><b>${data.risk_percentage}% – ${data.risk_level}</b></p>

                <h4>Indikator Risiko</h4>
                <table border="1" cellpadding="6" style="border-collapse: collapse; width: 100%;">
                    <tr><th>Indikator</th><th>Nilai</th></tr>
                    <tr><td>A: Sumber tidak jelas</td><td>${data.indicators.A}</td></tr>
                    <tr><td>B: Narasumber anonim</td><td>${data.indicators.B}</td></tr>
                    <tr><td>C: Judul sensasional</td><td>${data.indicators.C}</td></tr>
                    <tr><td>D: Konteks tidak jelas</td><td>${data.indicators.D}</td></tr>
                    <tr><td>E: Bahasa emosional</td><td>${data.indicators.E}</td></tr>
                </table>
            </div>
        `;
    } catch (err) {
        alert("Analisis gagal.");
    }

    document.getElementById("loading").style.display = "none";
}
</script>

</body>
</html>
